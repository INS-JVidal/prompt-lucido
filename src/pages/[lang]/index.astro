---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getCollection } from 'astro:content';
import { t, type Lang } from '../../i18n/utils';
import { ui } from '../../i18n/ui';

export function getStaticPaths() {
	return Object.keys(ui).map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Lang };

const posts = (await getCollection('blog', ({ data }) => (import.meta.env.PROD ? !data.draft : true) && data.lang === lang))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={`${t('site.title', lang)} — ${t('site.description', lang)}`} lang={lang}>
	<section class="hero container--narrow">
		<h1 class="hero__title">Prompt L<span class="hero__accent">ú</span>cido</h1>
		<p class="hero__lead">{t('home.lead', lang)}</p>
	</section>

	<section class="latest container--narrow">
		<h2 class="latest__heading">{t('home.recentPosts', lang)}</h2>
		<div class="latest__grid">
			{posts.length > 0 ? (
				posts.map((post) => {
					const slug = post.id.replace(/^(es|en)\//, '');
					return (
						<PostCard
							title={post.data.title}
							description={post.data.description}
							pubDate={post.data.pubDate}
							href={`/${lang}/blog/${slug}`}
							series={post.data.series}
							readingTime={post.data.readingTime}
							lang={lang}
						/>
					);
				})
			) : (
				<p class="latest__empty">{t('blog.empty', lang)}</p>
			)}
		</div>
	</section>
</BaseLayout>

<style>
	.hero {
		padding: 4rem 0 3rem;
		text-align: center;
	}

	.hero__title {
		font-family: var(--font-heading);
		font-size: clamp(2.875rem, 7vw, 4rem);
		font-weight: 700;
		letter-spacing: -0.03em;
		line-height: 1.1;
	}

	.hero__accent {
		font-family: var(--font-body);
		color: var(--accent);
		font-style: italic;
		font-size: 110%;
		margin-right: 0.02em;
	}

	.hero__lead {
		font-family: var(--font-body);
		font-size: 1.7rem;
		font-style: italic;
		color: var(--text-secondary);
		margin-top: 1rem;
	}

	.latest {
		padding-bottom: 4rem;
	}

	.latest__heading {
		font-family: var(--font-heading);
		font-size: 1.05rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		color: var(--text-muted);
		margin-bottom: 1.5rem;
		padding-bottom: 0.5rem;
		border-bottom: 1px solid var(--border);
	}

	.latest__grid {
		display: flex;
		flex-direction: column;
		gap: 1.25rem;
	}

	.latest__empty {
		font-family: var(--font-body);
		color: var(--text-muted);
		font-size: 1.1rem;
	}

	@media (max-width: 768px) {
		.hero {
			padding: 2.5rem 0 2rem;
		}

		.hero__lead {
			font-size: 1.15rem;
		}
	}
</style>
