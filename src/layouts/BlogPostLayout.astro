---
import BaseLayout from './BaseLayout.astro';
import { t, type Lang } from '../i18n/utils';

interface Props {
	title: string;
	description: string;
	pubDate: Date;
	updatedDate?: Date;
	author?: string;
	tags?: string[];
	category?: string;
	readingTime?: number;
	lang?: string;
	image?: { src: string; mobileSrc?: string; alt: string };
}

const {
	title,
	description,
	pubDate,
	updatedDate,
	author = 'Beyond Vibe Coding',
	tags = [],
	category,
	readingTime,
	lang = 'es',
	image,
} = Astro.props;

const formattedDate = pubDate.toLocaleDateString(lang, {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});

const formattedUpdate = updatedDate?.toLocaleDateString(lang, {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});
---

<BaseLayout title={`${title} — Prompt Lúcido`} description={description} lang={lang}>
	<article class="post container--narrow">
		{image ? (
			<div class="post-hero">
				<picture>
					{image.mobileSrc && (
						<source media="(max-width: 768px)" srcset={image.mobileSrc} />
					)}
					<img src={image.src} alt={image.alt} />
				</picture>
				<header class="post-hero__header">
					{category && <span class="tag">{category}</span>}
					<h1 class="post__title">{title}</h1>
					<p class="post__meta">
						<time datetime={pubDate.toISOString()}>{formattedDate}</time>
						{readingTime && <span>&middot; {readingTime} {t('post.readingTime', lang as Lang)}</span>}
					</p>
					{updatedDate && (
						<p class="post__updated">{t('post.updated', lang as Lang)} {formattedUpdate}</p>
					)}
				</header>
			</div>
		) : (
			<header class="post__header">
				{category && <span class="tag">{category}</span>}
				<h1 class="post__title">{title}</h1>
				<p class="post__meta">
					<time datetime={pubDate.toISOString()}>{formattedDate}</time>
					{readingTime && <span>&middot; {readingTime} {t('post.readingTime', lang as Lang)}</span>}
				</p>
				{updatedDate && (
					<p class="post__updated">{t('post.updated', lang as Lang)} {formattedUpdate}</p>
				)}
			</header>
		)}

		<div class="prose">
			<slot />
		</div>

		{tags.length > 0 && (
			<footer class="post__tags">
				{tags.map((t) => (
					<span class="tag">{t}</span>
				))}
			</footer>
		)}
	</article>
</BaseLayout>

<style>
	.post {
		padding-top: 0;
		padding-bottom: 4rem;
	}

	/* --- Hero: image + overlaid header --- */

	.post-hero {
		position: relative;
		max-height: 350px;
		overflow: hidden;
		border-radius: 12px;
		margin-bottom: 2.5rem;
	}

	.post-hero img {
		display: block;
		width: 100%;
		height: 350px;
		object-fit: cover;
	}

	.post-hero::after {
		content: '';
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		height: 70%;
		background: linear-gradient(to bottom, transparent 0%, #FAF9F6 100%);
		pointer-events: none;
		z-index: 1;
	}

	.post-hero__header {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		padding: 2rem;
		z-index: 2;
	}

	/* --- Fallback header (no image) --- */

	.post__header {
		margin-bottom: 2.5rem;
		padding-bottom: 2rem;
		border-bottom: 1px solid var(--border);
	}

	/* --- Shared text styles --- */

	.post__title {
		font-family: var(--font-heading);
		font-size: clamp(2.3rem, 5vw, 3.15rem);
		font-weight: 700;
		line-height: 1.15;
		letter-spacing: -0.02em;
		margin-top: 0.75rem;
		color: #1A1A19;
	}

	.post__meta {
		font-family: var(--font-ui);
		font-size: 0.95rem;
		color: #6B6B63;
		margin-top: 1rem;
		display: flex;
		gap: 0.5rem;
		align-items: center;
	}

	.post__updated {
		font-family: var(--font-ui);
		font-size: 0.875rem;
		color: #6B6B63;
		margin-top: 0.25rem;
		font-style: italic;
	}

	.post__tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		margin-top: 3rem;
		padding-top: 2rem;
		border-top: 1px solid var(--border);
	}

	@media (max-width: 768px) {
		.post {
			padding-bottom: 3rem;
		}

		.post-hero {
			max-height: 250px;
		}

		.post-hero img {
			height: 250px;
		}

		.post-hero__header {
			padding: 1.25rem;
		}

		.post__header {
			margin-bottom: 1.75rem;
		}
	}
</style>
